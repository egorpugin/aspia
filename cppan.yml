local_settings:
    #storage_dir: .s
    use_shared_libs: false
    builds:
        vs2017:
            generator: Visual Studio 15 2017
            #cxx_flags: /W0
        vs2017_64:
            generator: Visual Studio 15 2017 Win64
            #cxx_flags: /W0
        vs_preview:
            env:
                VS150COMNTOOLS: c:/Program Files (x86)/Microsoft Visual Studio/Preview/Community/

root_project: pvt.egorpugin.aspia
common_settings:
    c++: 17
    create_default_api: true
    default_api_start: aspia
    root_dir: source
    options:
        any:
            definitions:
                private:
                    - _SILENCE_CXX17_ITERATOR_BASE_CLASS_DEPRECATION_WARNING
                    - _CRT_SECURE_NO_WARNINGS
                    - CORE_IMPLEMENTATION
                public:
                    - _UNICODE
                    - UNICODE
    post_sources: |
        file(GLOB_RECURSE x "${SDIR}/*")
        source_group(TREE ${SDIR} PREFIX "Source Files" FILES ${x})

projects:
    console:
        executable_type: win32
        rc_enabled: false
        files:
            - console/.*
        dependencies:
            - client
            - core
            - crypto
            - network
            - protocols
            - system_info

            - pvt.cppan.demo.qtproject.qt.base.plugins.platforms.windows: 5
            - pvt.cppan.demo.qtproject.qt.base.plugins.styles.windowsvista: 5
            - pvt.cppan.demo.qtproject.qt.base.winmain: 5
            - name: pvt.cppan.demo.qtproject.qt.base.widgets
              ref: WIDGETS
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.core
              ref: CORE
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
              ref: MOC_COMMAND
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
              ref: UIC_COMMAND
              version: 5

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/console/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})


    host_config:
        executable_type: win32
        rc_enabled: false
        files:
            - host/host_config_entry_point.cc
            - host/host_config.rc
        dependencies:
            - core
            - pvt.cppan.demo.qtproject.qt.base.plugins.platforms.windows: 5
            - pvt.cppan.demo.qtproject.qt.base.plugins.styles.windowsvista: 5
            - pvt.cppan.demo.qtproject.qt.base.winmain: 5

    host_service:
        #executable_type: win32
        rc_enabled: false
        files:
            - host/win/host_service_entry_point.cc
            - host/win/host_service.rc
        dependencies:
            - core
            - pvt.cppan.demo.qtproject.qt.base.plugins.platforms.windows: 5
            - pvt.cppan.demo.qtproject.qt.base.plugins.styles.windowsvista: 5
            #- pvt.cppan.demo.qtproject.qt.base.winmain: 5

    host:
        executable_type: win32
        rc_enabled: false
        files:
            - host/win/host_entry_point.cc
            - host/win/host.rc
        dependencies:
            - core
            - pvt.cppan.demo.qtproject.qt.base.plugins.platforms.windows: 5
            - pvt.cppan.demo.qtproject.qt.base.plugins.styles.windowsvista: 5
            - pvt.cppan.demo.qtproject.qt.base.winmain: 5

    host_notifier:
        executable_type: win32
        rc_enabled: false
        files:
            - host/host_notifier_entry_point.cc
            - host/host_notifier.rc
        dependencies:
            - core
            - pvt.cppan.demo.qtproject.qt.base.plugins.platforms.windows: 5
            - pvt.cppan.demo.qtproject.qt.base.plugins.styles.windowsvista: 5
            - pvt.cppan.demo.qtproject.qt.base.winmain: 5


    protocols:
        type: lib
        static_only: true
        custom: true
        files:
            - protocol/.*
        dependencies:
            - pvt.cppan.demo.google.protobuf.protobuf: 3
            - name: pvt.cppan.demo.google.protobuf.protoc
              version: 3
        post_sources: |
            file(GLOB_RECURSE protos "${SDIR}/protocol/*.proto")
            foreach(f ${protos})
                cppan_genpb(${f})
            endforeach()

    resources:
        type: lib
        static_only: true
        custom: true
        files:
            - resources/.*

        dependencies:
            - name: pvt.cppan.demo.qtproject.qt.base.core
              ref: CORE
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.rcc
              ref: RCC_COMMAND
              version: 5

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            #
            set(Qt5Core_RCC_EXECUTABLE ${RCC_COMMAND})
            qt5_add_resources(rcc ${SDIR}/resources/resources.qrc)
            set(src ${src} ${rcc})


    base:
        type: lib
        files:
            - base/.*
        dependencies:
            - protocols
            - pvt.cppan.demo.qtproject.qt.base.core: 5

    codec:
        type: lib
        files:
            - codec/.*
        dependencies:
            public:
                - base
                - pvt.cppan.demo.qtproject.qt.base.gui: 5
            private:
                - pvt.cppan.demo.dead2.zlib_ng: develop
                - pvt.cppan.demo.chromium.libyuv.libyuv: master
                - pvt.cppan.demo.webmproject.vpx: 1

    crypto:
        type: lib
        files:
            - crypto/.*
        dependencies:
            public:
                - base
            private:
                - pvt.cppan.demo.jedisct1.libsodium: 1

    desktop_capture:
        type: lib
        files:
            - desktop_capture/.*
        dependencies:
            public:
                - base
                - pvt.cppan.demo.qtproject.qt.base.gui: 5
            private:
                - pvt.cppan.demo.mysticial.featuredetector: master

    network:
        type: lib
        files:
            - network/.*
        dependencies:
            private:
                - pvt.cppan.demo.qtproject.qt.base.network: 5

            public:
                - base

                - name: pvt.cppan.demo.qtproject.qt.base.widgets
                  ref: WIDGETS
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.core
                  ref: CORE
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
                  ref: MOC_COMMAND
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
                  ref: UIC_COMMAND
                  version: 5

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/network/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})

    ipc:
        type: lib
        files:
            - ipc/.*
        dependencies:
            private:
                - pvt.cppan.demo.qtproject.qt.base.network: 5
            public:
                - base

                - name: pvt.cppan.demo.qtproject.qt.base.widgets
                  ref: WIDGETS
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.core
                  ref: CORE
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
                  ref: MOC_COMMAND
                  version: 5
                - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
                  ref: UIC_COMMAND
                  version: 5

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/ipc/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})

    client:
        type: lib
        files:
            - base_client/.*
            - client/.*

        dependencies:
            - base
            - network
            - resources

            - pvt.cppan.demo.qtproject.qt.base.xml: 5
            - name: pvt.cppan.demo.qtproject.qt.base.widgets
              ref: WIDGETS
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.core
              ref: CORE
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
              ref: MOC_COMMAND
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
              ref: UIC_COMMAND
              version: 5

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/client/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})

    system_info:
        type: lib
        files:
            - system_info/.*
        dependencies:
            - base

            - pvt.cppan.demo.qtproject.qt.base.xml: 5
            - name: pvt.cppan.demo.qtproject.qt.base.widgets
              ref: WIDGETS
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.core
              ref: CORE
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
              ref: MOC_COMMAND
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
              ref: UIC_COMMAND
              version: 5
            - pvt.cppan.demo.google.protobuf.protobuf: 3
            - name: pvt.cppan.demo.google.protobuf.protoc
              version: 3

        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/system_info/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})

            #
            file(GLOB_RECURSE protos "${SDIR}/system_info/*.proto")
            foreach(f ${protos})
                cppan_genpb(${f})
            endforeach()




    core:
        type: lib
        #shared_only: true
        files:
            - host/.*

        exclude_from_build:
            - .*entry_point.cc$
            - .*manifest$
            - .*rc$

        options:
            any:
                link_libraries:
                    win32:
                        public:
                            - Wtsapi32
                            - sas
                            - comsuppw

        dependencies:
            - base
            - client
            - codec
            - crypto
            - desktop_capture
            - ipc
            - network
            - resources
            - system_info

            - pvt.cppan.demo.qtproject.qt.winextras: 5
            - name: pvt.cppan.demo.qtproject.qt.base.widgets
              ref: WIDGETS
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.core
              ref: CORE
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.moc
              ref: MOC_COMMAND
              version: 5
            - name: pvt.cppan.demo.qtproject.qt.base.tools.uic
              ref: UIC_COMMAND
              version: 5



        post_sources: |
            include(${CORE_SDIR}/src/corelib/Qt5CoreMacros.cmake)

            set(moc ${src})
            list(FILTER moc INCLUDE REGEX ".h$")

            find_moc_targets(moc ${moc})

            set(Qt5Core_MOC_EXECUTABLE ${MOC_COMMAND})
            cppan_qt5_wrap_cpp(moc ${moc} TARGET ${this})
            list(FILTER moc INCLUDE REGEX ".cpp$")
            set(src ${src} ${moc})

            #
            include(${WIDGETS_SDIR}/src/widgets/Qt5WidgetsMacros.cmake)
            file(GLOB_RECURSE uis "${SDIR}/host/*.ui")
            set(Qt5Widgets_UIC_EXECUTABLE ${UIC_COMMAND})
            qt5_wrap_ui(uic ${uis})
            set(src ${src} ${uic})

